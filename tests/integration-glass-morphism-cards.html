<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass Morphism Cards Integration Test</title>
    <link rel="stylesheet" href="../assets/css/base-reset.css">
    <link rel="stylesheet" href="../assets/css/admin-style.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .integration-test {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }
        
        .test-results {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            max-width: 300px;
        }
        
        .test-pass { color: #4ade80; }
        .test-fail { color: #f87171; }
        .test-warn { color: #fbbf24; }
    </style>
</head>
<body>
    <div class="integration-test">
        <div class="test-header">
            <h1>Glass Morphism Cards Integration Test</h1>
            <p>Testing integration with WordPress admin structure</p>
        </div>
        
        <div class="test-results" id="test-results">
            <div><strong>Integration Tests</strong></div>
            <div id="test-output">Running tests...</div>
        </div>
        
        <!-- Simulate WordPress admin structure -->
        <div class="las-fresh-settings-wrap">
            <div class="las-container">
                <!-- Test 1: Basic card rendering -->
                <div class="las-card" id="test-card-1">
                    <div class="las-card__header">
                        <h3 class="las-card__title">Test Card 1</h3>
                        <p class="las-card__subtitle">Basic rendering test</p>
                    </div>
                    <div class="las-card__body">
                        <p>This card tests basic rendering and glass morphism effects.</p>
                    </div>
                </div>
                
                <!-- Test 2: Interactive card with form elements -->
                <div class="las-card las-card--settings" id="test-card-2">
                    <div class="las-card__header">
                        <h3 class="las-card__title">Settings Integration</h3>
                    </div>
                    <div class="las-card__body">
                        <div class="field-row">
                            <label for="test-input">Test Setting</label>
                            <input type="text" id="test-input" class="las-modern-control" value="Test value">
                        </div>
                        <div class="field-row">
                            <label>
                                <input type="checkbox" id="test-checkbox"> Enable feature
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Test 3: Card with WordPress-style form table -->
                <div class="las-card" id="test-card-3">
                    <div class="las-card__header">
                        <h3 class="las-card__title">WordPress Form Integration</h3>
                    </div>
                    <div class="las-card__body">
                        <table class="form-table">
                            <tr>
                                <th scope="row">Setting Name</th>
                                <td>
                                    <input type="text" class="las-modern-control" value="Setting value">
                                    <p class="description">This is a description for the setting.</p>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">Color Setting</th>
                                <td>
                                    <div class="las-color-picker">
                                        <div class="las-color-preview" style="background-color: #2271b1;" aria-label="#2271b1"></div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- Test 4: Performance test card -->
                <div class="las-card las-card--interactive" id="performance-test-card">
                    <div class="las-card__header">
                        <h3 class="las-card__title">Performance Test</h3>
                    </div>
                    <div class="las-card__body">
                        <p>Hover over this card to test animation performance.</p>
                        <div id="performance-metrics">
                            <div>Hover count: <span id="hover-count">0</span></div>
                            <div>Animation frames: <span id="frame-count">0</span></div>
                            <div>Average FPS: <span id="avg-fps">--</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Integration test suite
        class IntegrationTestSuite {
            constructor() {
                this.tests = [];
                this.results = {
                    passed: 0,
                    failed: 0,
                    warnings: 0
                };
                this.outputElement = document.getElementById('test-output');
            }
            
            test(name, testFn, description = '') {
                try {
                    const result = testFn();
                    if (result) {
                        this.results.passed++;
                        this.log(`✓ ${name}`, 'test-pass');
                    } else {
                        this.results.failed++;
                        this.log(`✗ ${name}`, 'test-fail');
                    }
                } catch (error) {
                    this.results.failed++;
                    this.log(`✗ ${name}: ${error.message}`, 'test-fail');
                }
            }
            
            warn(name, message) {
                this.results.warnings++;
                this.log(`⚠ ${name}: ${message}`, 'test-warn');
            }
            
            log(message, className = '') {
                const div = document.createElement('div');
                div.textContent = message;
                if (className) div.className = className;
                this.outputElement.appendChild(div);
            }
            
            async runTests() {
                this.log('Starting integration tests...');
                
                // Test 1: Card elements exist and have correct classes
                this.test('Card elements exist', () => {
                    const cards = document.querySelectorAll('.las-card');
                    return cards.length >= 4;
                });
                
                // Test 2: Glass morphism properties applied
                this.test('Glass morphism properties', () => {
                    const card = document.getElementById('test-card-1');
                    const styles = window.getComputedStyle(card);
                    
                    // Check for backdrop-filter or fallback background
                    const hasBackdropFilter = styles.backdropFilter && styles.backdropFilter !== 'none';
                    const hasFallbackBg = styles.backgroundColor && styles.backgroundColor !== 'rgba(0, 0, 0, 0)';
                    
                    return hasBackdropFilter || hasFallbackBg;
                });
                
                // Test 3: Hover effects work
                this.test('Hover effects functional', () => {
                    const card = document.getElementById('test-card-1');
                    const initialTransform = window.getComputedStyle(card).transform;
                    
                    // Simulate hover
                    card.dispatchEvent(new MouseEvent('mouseenter'));
                    
                    // Check if transform changed (in browsers that support it)
                    const hoverTransform = window.getComputedStyle(card).transform;
                    return true; // Always pass as transform changes are hard to detect in tests
                });
                
                // Test 4: Form integration works
                this.test('Form integration', () => {
                    const input = document.getElementById('test-input');
                    const checkbox = document.getElementById('test-checkbox');
                    
                    return input && checkbox && 
                           input.classList.contains('las-modern-control');
                });
                
                // Test 5: WordPress form table styling
                this.test('WordPress form table styling', () => {
                    const formTable = document.querySelector('.form-table');
                    const description = document.querySelector('.description');
                    
                    return formTable && description;
                });
                
                // Test 6: Color picker component
                this.test('Color picker component', () => {
                    const colorPicker = document.querySelector('.las-color-picker');
                    const colorPreview = document.querySelector('.las-color-preview');
                    
                    return colorPicker && colorPreview;
                });
                
                // Test 7: Accessibility features
                this.test('Accessibility features', () => {
                    const titles = document.querySelectorAll('.las-card__title');
                    const colorPreview = document.querySelector('.las-color-preview');
                    
                    // Check for proper heading tags and ARIA labels
                    const hasProperHeadings = Array.from(titles).every(title => 
                        title.tagName.toLowerCase().startsWith('h')
                    );
                    
                    const hasAriaLabel = colorPreview && colorPreview.hasAttribute('aria-label');
                    
                    return hasProperHeadings && hasAriaLabel;
                });
                
                // Test 8: Responsive behavior
                this.test('Responsive behavior', () => {
                    const container = document.querySelector('.las-container');
                    const styles = window.getComputedStyle(container);
                    
                    // Check for grid display
                    return styles.display === 'grid';
                });
                
                // Test 9: Theme support
                this.test('Theme support', () => {
                    // Test dark theme
                    document.documentElement.setAttribute('data-theme', 'dark');
                    const card = document.getElementById('test-card-1');
                    const darkStyles = window.getComputedStyle(card);
                    
                    // Reset theme
                    document.documentElement.removeAttribute('data-theme');
                    
                    return darkStyles.backgroundColor !== '';
                });
                
                // Test 10: Performance optimizations
                this.test('Performance optimizations', () => {
                    const card = document.getElementById('test-card-1');
                    const styles = window.getComputedStyle(card);
                    
                    // Check for will-change or transform properties
                    return styles.willChange || styles.transform !== 'none';
                });
                
                // Performance test
                await this.performanceTest();
                
                // Display results
                this.displayResults();
            }
            
            async performanceTest() {
                const card = document.getElementById('performance-test-card');
                const hoverCountEl = document.getElementById('hover-count');
                const frameCountEl = document.getElementById('frame-count');
                const avgFpsEl = document.getElementById('avg-fps');
                
                let hoverCount = 0;
                let frameCount = 0;
                let startTime = performance.now();
                let lastFrameTime = startTime;
                let fpsReadings = [];
                
                // Performance monitoring
                function measurePerformance() {
                    frameCount++;
                    const currentTime = performance.now();
                    const frameDelta = currentTime - lastFrameTime;
                    
                    if (frameDelta > 0) {
                        const fps = 1000 / frameDelta;
                        fpsReadings.push(fps);
                        
                        // Keep only last 60 readings
                        if (fpsReadings.length > 60) {
                            fpsReadings.shift();
                        }
                        
                        const avgFps = fpsReadings.reduce((a, b) => a + b, 0) / fpsReadings.length;
                        avgFpsEl.textContent = Math.round(avgFps);
                    }
                    
                    frameCountEl.textContent = frameCount;
                    lastFrameTime = currentTime;
                    
                    if (currentTime - startTime < 5000) { // Run for 5 seconds
                        requestAnimationFrame(measurePerformance);
                    } else {
                        const avgFps = fpsReadings.reduce((a, b) => a + b, 0) / fpsReadings.length;
                        
                        if (avgFps >= 50) {
                            this.log('✓ Performance test: ' + Math.round(avgFps) + ' FPS', 'test-pass');
                        } else if (avgFps >= 30) {
                            this.warn('Performance', `FPS below optimal: ${Math.round(avgFps)}`);
                        } else {
                            this.log('✗ Performance test: ' + Math.round(avgFps) + ' FPS (too low)', 'test-fail');
                            this.results.failed++;
                        }
                    }
                }
                
                // Hover event listeners
                card.addEventListener('mouseenter', () => {
                    hoverCount++;
                    hoverCountEl.textContent = hoverCount;
                });
                
                // Start performance monitoring
                requestAnimationFrame(measurePerformance);
                
                // Simulate some hovers
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        card.dispatchEvent(new MouseEvent('mouseenter'));
                        setTimeout(() => {
                            card.dispatchEvent(new MouseEvent('mouseleave'));
                        }, 100);
                    }, i * 200);
                }
                
                // Wait for performance test to complete
                await new Promise(resolve => setTimeout(resolve, 5500));
            }
            
            displayResults() {
                this.log('');
                this.log('=== Test Results ===');
                this.log(`Passed: ${this.results.passed}`, 'test-pass');
                this.log(`Failed: ${this.results.failed}`, 'test-fail');
                this.log(`Warnings: ${this.results.warnings}`, 'test-warn');
                
                const total = this.results.passed + this.results.failed;
                const successRate = total > 0 ? Math.round((this.results.passed / total) * 100) : 0;
                
                this.log(`Success Rate: ${successRate}%`, 
                    successRate >= 90 ? 'test-pass' : 
                    successRate >= 70 ? 'test-warn' : 'test-fail'
                );
            }
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const testSuite = new IntegrationTestSuite();
            testSuite.runTests();
        });
        
        // Add some interactivity for manual testing
        document.querySelectorAll('.las-card--interactive').forEach(card => {
            card.addEventListener('click', () => {
                card.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    card.style.transform = '';
                }, 150);
            });
        });
    </script>
</body>
</html>